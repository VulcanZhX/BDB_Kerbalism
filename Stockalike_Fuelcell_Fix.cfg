//inital configs for fuel cell support in BDB SM Tanks(WIP)

//Gemini SM, add Kerbalism fuel cell
@PART[bluedog_Gemini_EquipmentModule|bluedog_Gemini_LunarReconSM|bluedog_Gemini_ArrowSM]:NEEDS[Bluedog_DB]:AFTER[KerbalismDefault]
{
    !MODULE[ModuleResourceConverter] {}
    // !RESOURCE[ElectricCharge] {}

    MODULE
    {
        name = ProcessController
        resource = _FuelCell
        title = #KERBALISM_H2O2FuelCell_title//H2+O2 fuel cell
        capacity = 0.8
        //valve_i = 1 // workaround until we have a better way to deal with dump valves
    }

    MODULE
    {
        name = ProcessController
        resource = _MonopropFuelCell
        title = #KERBALISM_MonopropO2FuelCell_title//Monoprop+O2 fuel cell
        capacity = 6
    }

    MODULE
    {
        name = Configure
        title = Fuel Cell
        slots = 1

        SETUP
        {
            name = Hydrogen Oxygen Fuel Cell
            desc = #KERBALISM_H2O2FuelCell_desc//Burns <b>Hydrogen</b> gas and <b>Oxygen</b> gas, producing <b>Water</b> as a by-product.

            MODULE
            {
                type = ProcessController
                id_field = resource
                id_value = _FuelCell
            }
        }

        SETUP
        {
            name = Monoprop Oxygen Fuel Cell
            desc = #KERBALISM_MonopropO2FuelCell_desc2//Burns <b>MonoPropellant</b> and <b>Oxygen</b> gas, producing <b>Water</b> and <b>Nitrogen</b> gas as by-products.
            tech = basicScience

            MODULE
            {
                type = ProcessController
                id_field = resource
                id_value = _MonopropFuelCell
            }
        }
        

        MODULE:NEEDS[FeatureReliability]
        {
            name = Reliability
            type = ProcessController
            title = #KERBALISM_FuelCell_title//Fuel Cell
            redundancy = Power Generation
            repair = Engineer
            mtbf = 72576000
            extra_cost = 1.0
            extra_mass = 0.5
        }
    }
}


//rewrite B9PS config(WIP)
@PART[bluedog_Gemini_EquipmentModule|bluedog_Gemini_LunarReconSM|bluedog_Gemini_ArrowSM]:AFTER[Bluedog_DB]  //adjust patching order
{
    MODULE
	{
		name = ModuleB9PartSwitch
		switcherDescription = Fuel Cell Tank Config
		switcherDescriptionPlural = Fuel Cell Tank Configs
		moduleID = fuelSwitch
		//baseVolume = 1000.0

		baseVolume = 0

		SUBTYPE
		{
			name = None
			title = None
			descriptionSummary = No frills.
			descriptionDetail = Lightest and cheapest option.
			defaultSubtypePriority = 0
			addedMass = 0.0
			addedCost = 0
			
		}

		SUBTYPE
		{
			name = MonoProp
			title = Monopropellant
			descriptionSummary = Monopropllant Fuelcell //Produces 40 EC per 1 kg of Monopropellant
			descriptionDetail = A simple device that consumes Monopropellant to produce EC.
			defaultSubtypePriority = 1
			addedMass = 0.05
			addedCost = 750
		}

		SUBTYPE
		{
			name = H2O2
			title = Hydrogen/Oxygen
			descriptionSummary = Hydrogen/Oxygen Fuelcell //Produces 2695 EC per 1 kg of H2/O2.
			descriptionDetail = Efficient fuel cell that does not consume Monopropellant. Hydrogen and Oxygen are combined to produce EC and water.
			defaultSubtypePriority = 2
			addedMass = 0.3
			addedCost = 2250
			volumeAdded = 80
			tankType = bdbSupplyH2O2
        }
	}

    @MODULE[ModuleB9PartSwitch]:HAS[#moduleID[volumeSwitch]]
    {
       @parentID = fuelSwitch //No RealFuels,WIP
    }
    
    !MODULE[ModuleB9PartSwitch]:HAS[#moduleID[fuelCellSwitch]] {}
    
}


@PART[bluedog_Gemini_EquipmentModule|bluedog_Gemini_LunarReconSM|bluedog_Gemini_ArrowSM]:AFTER[Bluedog_DB]  //adjust patching order
{
    @MODULE[ModuleB9AssignUiGroups]
    {
        !MODULE,1{} //null reference of ModuleResourceConverter
    }
}


//Apollo SM,add a Kerbalism fuel cell array
@PART[bluedog_Apollo_Block2_SM]:NEEDS[Bluedog_DB]:AFTER[KerbalismDefault]
{
    !MODULE[ModuleResourceConverter] {}
    // !RESOURCE[ElectricCharge] {}
    // !MODULE[ModuleB9PartSwitch]:HAS[#moduleID[fuelCellSwitch]] {} reduntant command

    MODULE
    {
        name = ProcessController
        resource = _FuelCell
        title = #KERBALISM_H2O2FuelCell_title//H2+O2 fuel cell
        capacity = 2.5
        //valve_i = 1 // workaround until we have a better way to deal with dump valves
    }

    MODULE
    {
        name = ProcessController
        resource = _MonopropFuelCell
        title = #KERBALISM_MonopropO2FuelCell_title//Monoprop+O2 fuel cell
        capacity = 18
    }

    MODULE
    {
        name = Configure
        title = Fuel Cell
        slots = 1

        SETUP
        {
            name = Hydrogen Oxygen Fuel Cell
            desc = #KERBALISM_H2O2FuelCell_desc//Burns <b>Hydrogen</b> gas and <b>Oxygen</b> gas, producing <b>Water</b> as a by-product.

            MODULE
            {
                type = ProcessController
                id_field = resource
                id_value = _FuelCell
            }
        }

        SETUP
        {
            name = Monoprop Oxygen Fuel Cell
            desc = #KERBALISM_MonopropO2FuelCell_desc2//Burns <b>MonoPropellant</b> and <b>Oxygen</b> gas, producing <b>Water</b> and <b>Nitrogen</b> gas as by-products.
            tech = basicScience

            MODULE
            {
                type = ProcessController
                id_field = resource
                id_value = _MonopropFuelCell
            }
        }
        

        MODULE:NEEDS[FeatureReliability]
        {
            name = Reliability
            type = ProcessController
            title = #KERBALISM_FuelCell_title//Fuel Cell
            redundancy = Power Generation
            repair = Engineer
            mtbf = 72576000
            extra_cost = 1.0
            extra_mass = 0.5
        }
    }
}